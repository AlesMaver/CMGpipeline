version 1.0


task wigToBigWig {
  input {
    Array[File] wig_files
    File ref_fasta_index
  }
  command <<<
    # set -exo pipefail
    set -e
    
    # make chrom_sizes file from 
    # cut -f1,2 /mnt/dataSeq/CROMWELL/FastqToVCFPipelineDatasets/hg19/hg19.fa.fai > chrom_sizes.txt
    cut -f1,2 ~{ref_fasta_index} > chrom_sizes.txt

    for x in ~{sep=' ' wig_files}
    do
        # sort -m -k1,1 -k2,2n "${x}" > $(basename "${x}" .bed).sorted.bed
        wigToBigWig "${x}" chrom_sizes.txt $(basename "${x}" .wig).bw
    done;
   >>>
 output {
   Array[File] bigWig_files = glob("*.bw")
 }
}

workflow wigToBigWig_wf {
  input {
    Array[File] wig_files
    File ref_fasta_index
  }
  call wigToBigWig {
    input:
      wig_files=wig_files,
      ref_fasta_index=ref_fasta_index
  }
  # output {
  #   Array[File] sorted_bed = sort_bed.sorted_bed
  # }
}
